<Page>
  {#each pageNotes as pageNote}
  <div class="page-note">
    <h3>{pageNote.title}</h3>
    {#if pageNote.content != null}
    <div>{@html pageNote.content}</div>
    {/if}
  </div>
  {/each}
  <div ref:page style="padding-bottom: 113%;">
    {#if showImage}
      <img ref:img alt :src on:load="stupid()">
    {:else}
      <div style="position: absolute;">{num}</div>
    {/if}
  </div>
</Page>

<script>
  import Page from './Page.html';

  export default {
    oncreate() {
      setTimeout(() => {
        if (document.body.contains(this.refs.page)) {
          this.set({showImage: true});
          const {img, page} = this.refs;
          const poll = setInterval(() => {
            if (img.naturalWidth) {
              clearInterval(poll);
              page.style = '';
            }
          }, 10);
        }
      }, 25);
    },
    data() {
      return {
        showImage: false,
        imageLoaded: false,
      };
    },
    computed: {
      pageNotes: ({notes}) => {
        return notes.filter((note) => {
          return note.location == null;
        });
      },
    },
    methods: {
      stupid() {
        this.refs.page.style = '';
        this.fire('pageLoaded', {
          adjustedHeight: this.refs.img.offsetHeight,
          prevHeight: 800,
          num: this.get().num - 1,
        });
      }
    },
    components: {Page},
  };
</script>

<style>
  ref:page {
    background: white;
    width: 100%;
    position: relative;
  }

  ref:img {
    display: block;
    width: 100%;
  }

  .page-note {
    text-align: left;
    background: white;
    border: solid 2px #ffe325;
    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
    margin: 0 0 1em 0;
    padding: 1em;
  }
</style>