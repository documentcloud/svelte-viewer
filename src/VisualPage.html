<div ref:container style="height: {height}px; overflow: hidden;">
  <div ref:page>
    <Page>
      <div ref:redsquare style="height: 500px;">
        <div style="position: absolute;">pg: {num} height: {height}</div>
      </div>
      <!-- {#each pageNotes as pageNote}
      <div class="page-note">
        <h3>{pageNote.title}</h3>
        {#if pageNote.content != null}
        <div>{@html pageNote.content}</div>
        {/if}
      </div>
      {/each}
      <div ref:subpage>
        {#if showImage}
          <div style="position: absolute;">{num} {height}</div>
          <img ref:img alt :src on:load="imgLoaded()">
        {:else}
          <div style="position: absolute;">{num}</div>
        {/if}
      </div> -->
    </Page>
  </div>
</div>

<script>
  import Page from './Page.html';

  export default {
    oncreate() {
      const {page} = this.get();
      setTimeout(() => {
        this.refs.redsquare.style.height = '1000px';
        this.updateHeight();
      }, 3000);
      // setTimeout(() => {
      //   if (document.body.contains(this.refs.subpage)) {
      //     this.set({showImage: true});
      //     const {img} = this.refs;
      //     const poll = setInterval(() => {
      //       if (img.naturalWidth) {
      //         clearInterval(poll);
      //         this.updateHeight();
      //       }
      //     }, 10);
      //   }
      // }, 25);
    },
    data() {
      return {
        showImage: false,
        imageLoaded: false,
      };
    },
    computed: {
      pageNotes: ({notes}) => {
        if (notes == null) return [];
        return notes.filter((note) => {
          return note.location == null;
        });
      },
    },
    methods: {
      imgLoaded() {
        this.updateHeight();
      },
      updateHeight() {
        this.setHeight(this.refs.page.offsetHeight);
      },
      setHeight(height) {
        const {page} = this.get();
        page.updateHeight(height);
        this.set({height});
      },
    },
    components: {Page},
  };
</script>

<style>
  ref:container {
    background: white;
    border: solid 1px gainsboro;
  }

  ref:redsquare {
    background: linear-gradient(#e66465, #9198e5);
    position: relative;
  }

  ref:subpage {
    background: white;
    width: 100%;
    position: relative;
  }

  ref:img {
    display: block;
    width: 100%;
  }

  .page-note {
    text-align: left;
    background: white;
    border: solid 2px #ffe325;
    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
    margin: 0 0 1em 0;
    padding: 1em;
  }
</style>