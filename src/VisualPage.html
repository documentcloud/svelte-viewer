<div ref:container>
  <Page>
    {#each pageNotes as pageNote}
    <div class="page-note">
      <h3>{pageNote.title}</h3>
      {#if pageNote.content != null}
      <div>{@html pageNote.content}</div>
      {/if}
    </div>
    {/each}
    <div ref:page style="padding-top: 113%;">
      {#if showImage}
        <div style="position: absolute;">{num} {height}</div>
        <img ref:img alt :src on:load="stupid()">
      {:else}
        <div style="position: absolute;">{num}</div>
      {/if}
    </div>
  </Page>
</div>

<script>
  import Page from './Page.html';

  export default {
    oncreate() {
      const {page} = this.get();
      page.updateHeight(this.refs.container.offsetHeight);
      setTimeout(() => {
        if (document.body.contains(this.refs.page)) {
          this.set({showImage: true});
          const {img} = this.refs;
          const poll = setInterval(() => {
            if (img.naturalWidth) {
              clearInterval(poll);
              this.refs.page.style = '';
              page.updateHeight(this.refs.container.offsetHeight);
            }
          }, 10);
        }
      }, 25);
    },
    data() {
      return {
        showImage: false,
        imageLoaded: false,
      };
    },
    computed: {
      pageNotes: ({notes}) => {
        if (notes == null) return [];
        return notes.filter((note) => {
          return note.location == null;
        });
      },
    },
    methods: {
      stupid() {
        const {page} = this.get();
        this.refs.page.style = '';
        page.updateHeight(this.refs.container.offsetHeight);
      }
    },
    components: {Page},
  };
</script>

<style>
  ref:page {
    background: white;
    width: 100%;
    position: relative;
  }

  ref:img {
    display: block;
    width: 100%;
  }

  .page-note {
    text-align: left;
    background: white;
    border: solid 2px #ffe325;
    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
    margin: 0 0 1em 0;
    padding: 1em;
  }
</style>